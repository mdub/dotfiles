#! /usr/bin/env ruby
# frozen_string_literal: true

Gem.paths = { "GEM_HOME" => Gem.user_dir }

require "bundler/inline"

gemfile do
  source "https://rubygems.org"
  gem "clamp"
  gem "redcarpet"
end

require "tempfile"

Clamp do

  parameter "[FILE]", "markdown file to render (default: stdin)", attribute_name: :input_file

  def execute
    markdown_content = read_markdown_input
    html_content = html_from_markdown(markdown_content)
    puts html_content
  end

  private

  def read_markdown_input
    if input_file
      File.read(input_file)
    else
      $stdin.read
    end
  rescue Errno::ENOENT => e
    signal_error(e.message)
  end

  def html_from_markdown(markdown_content)
    renderer = Redcarpet::Render::HTML.new
    markdown = Redcarpet::Markdown.new(renderer,
                                       autolink: true,
                                       tables: true,
                                       fenced_code_blocks: true,
                                       strikethrough: true)
    markdown.render(markdown_content)
  end

end
